# Messaging app documentation:

Feel free to email [victormartin96@outlook.com](victormartin96@outlook.com) to request changes, impromevents, fixes or clarifications

## Settings

Can be seen and edited in the "File Explorer Tab". These are the main parts:

### Experiment descriptions

List of `experiment-descriptions` CSV files. Each of them will contain a list of any participation of a bot in a room, described as follows:

- `"bot-description"`: Specifies the folder in `bot-descriptions` describing the bot prompts
- `"username"`: Name to show in the frontend
- `"email"`: Fake email adress to store in the generated conversation history CSV files
- `"chatroom"`: Room in which the bot will participate
- `"role"`: Can be either `"simple"` or `"elaborated"`. If using elaborated prompts, the bot will make some self-reflection before participating
- `"enable"`: if `false` the bot will not participate, if `true`, it will. Useful to activate the participation or not based on the researcher's needs.

### Bot descriptions

Located in the `bot-descriptions`. Will contain a few folders, each with a name (this name will be used by the `"bot-description"` field of the `experiment-descriptions` JSON files). It will contain a few prompts:

- `behavior-prompt.txt`: General rules for the bot to indicate to it how to interact with the chat or the sort of context it's into
- `simple-prompt.txt`: Simple prompt. Combined with `behavior-prompt.txt` it will generate the full system prompt if the bot has a `simple` role.
- `elaborated-prompt.txt`: Elaborated prompt. Combined with `behavior-prompt.txt` it will call the LLM to generate some self-reflection.
- `elaborated-prompt-completion.txt`: Added at the end of the self-reflection to complete the full system prompt

## `hate_speech.txt`

List of hate speech phrases of the Verenetti experiment. Empty lines and lines starting with `#` will be ignored. Please place each phrase in a different line.

## `rooms.csv`

CSV file describing all available rooms. Given by fields `id,title,description`. `id` will represent the name of the room. This way a room with `id == room1A` will be available at `https://delibexplatform.onrender.com/room1A`. `title` will represent the title in the room, `description` will represent the subtitle/description in it. **IMPORTANT NOTE:** This is a CSV file, so remember that commas can only appear when dividing the fields, not for the description. Please use a different marker for that.

## Outputs

Can be seen in the `Output Explorer` tab

Will contain the following:

- **`conversations/`**: List of CSV files (each for each room) of the messages added in that room. The CSV's rows are `roomId,name,email,content,timestamp,mentions`. `mentions` will be a concatenation of the words with an "@" at the beginning of them (indicating a mention to some member in the chat)
- **`elaborated_prompts/`**: Contains a bunch of `.txt` files with the full system prompts generated by the `elaborated` bots. The file names are given by the model used followed by the timestamp of the generation
- **Error logs**: Useful to troubleshoot/debug issues
- **`logs/`**: Similar stuff, these are the debug logs generated by each bot, useful for debugging

## Programs

Both `LLM Bot` and `Haterbot` tabs are similar. They will show a few options to initialize each corresponding bot. After that, a command to run the respective backend python program will be shown (only interesting to developers), and at the last row there will be a some text regarding the program execution status.

### LLM Bot

This is the most complex bot. It monitors new messages, spends some time idle simulating writing or reading, and collects and manages all the current message history to create a new message (via an LLM) that will be sent to the chat right after.

### Haterbot

This will run the `HaterBot`, which will randomly send the phrases stored in the `hate_speech.txt` file. Specify how many different Haterbots you want acting in the chat, what is the overall frequency of its messages and on which rooms you want it to act.

Specify the experiment name (this will be linked to the JSON file in `experiment-descriptions`, which also specifies which LLM bots should act in which rooms), the LLM model used (see the related links to try with different ones), and a few more options to either send a "hello everyone" message when initialized, ignore the LLM API calls to just send "lorem ipsum" or increase its working speed by a certain factor (useful for testing)

# Deprecated:

Note: This section is based on old information so a big part of it is useless, wrong or at least not up-to-date. However I chose to leave it here in case someone in the future needs some context.

## Information for the researcher:

### Main commands:

- `npm dev run`: Starts the server. Might need a few dependencies to be installed first if ran for the first time
- `python3 hate_speech_generator.py --freq 10`. Run the script to send predefined phrases from `hate_speech.txt`. The `--freq` argument is optional, it says every how many seconds to send the message (if not specified, that will be every 10s)
- `python3 main.py`. Run main program to load the bots, read messages from the chat, and make the bots add their own. Optional argument `--start` will send a greeting message right away when the bot is initialized, and optional message `--speedup 10` will speed up the bots a factor of 10x (or by any other given number. If no number is given but the argument is provided, 10x is the default).

### Interesting files to know about

- `logs/*.log`: Contains debug info for each of the bots, (e.g. `logs/ElonMusk.log`). If the word `ERROR` appears, that signals an error (some times the bot will crash, some it will continue but it might not work properly, for example it might not generate a response)
- `pages/[roomId].tsx`. This will describe the chats. Feel free to change this small block of code, or add new lines:

```js
const chatRooms = {
  chat1: {
    title: "Chat Room 1",
    description: "Welcome to the first chat room!",
  },
  chat2: { title: "Chat Room 2", description: "This is the second chat room." },
  // Add more chat rooms as needed
};
```

This gives a list of rooms. For example, the first one says that going to the URL `.../chat1` there will be a chat with the given `title` and `description`.

- `api_keys.json` contains all API keys for the LLMs and the (deprecated) discord bots
- `constants.py`. List of constants used. Feel free to modify the ones for reading and writing to make the bot read/write faster or spend a different random idle time before reading or writing.
- `conversations.csv`. As messages are added to the chats, messages will be appended here as a CSV. The columns of the CSV are the following: `roomId,name,email,content,timestamp,mentions`
- `hate_speech_generator.py`. This will add random hate messages to the chat via HaterBot3000 (provisional name :D). Instructions on how to execute provided in this README file
- `hate_speech.txt`: Every line will contain one hate message. To be loaded and sent by executing `hate_speech_generator.py`
- `main.py`. Main program to load the bots, read messages from the chat, and make the bots add their own. Instructions on how to execute provided in this README file

## File info

Here’s a breakdown of the files in the project, separated into several categories.

---

### **Frontend Files**

| **File**                  | **Description**                                                                                        |
| ------------------------- | ------------------------------------------------------------------------------------------------------ |
| `components/ChatRoom.tsx` | A React component in TypeScript for rendering the chat room interface.                                 |
| `lib/types.ts`            | Contains TypeScript type definitions, typically used to enforce typing across the frontend.            |
| `next.config.js`          | Configuration file for Next.js, used to modify the default behavior of the framework.                  |
| `package-lock.json`       | Locks the exact versions of dependencies for consistent installs.                                      |
| `package.json`            | Defines project dependencies and scripts, crucial for managing the project’s Node.js packages.         |
| `pages/[roomId].tsx`      | Dynamic Next.js route for chat rooms, rendering pages based on the `roomId` parameter.                 |
| `pages/_app.tsx`          | Custom Next.js `_app` component, used to initialize pages and inject global styles or settings.        |
| `pages/api/messages.ts`   | API route in Next.js, handles requests related to chat messages (e.g., saving or retrieving messages). |
| `pages/index.tsx`         | The homepage of the application, written in TypeScript and rendered by Next.js.                        |
| `postcss.config.js`       | Configuration file for PostCSS, a tool used for processing and transforming CSS.                       |
| `styles/globals.css`      | Global styles for the application. Imported in `_app.tsx` to apply across all pages.                   |
| `tailwind.config.ts`      | Configuration file for TailwindCSS, used to customize the utility-first CSS framework.                 |
| `tsconfig.json`           | TypeScript configuration file, defining how TypeScript should compile the project’s code.              |

---

### **Backend Files**

(**TODO:** Need to update the descriptions)
| **File** | **Description** |
| -------------------------- | ---------------------------------------------------------------------------------------------------------- |
| `api.py` | Backend API file, likely handling HTTP requests and responses for the application. |
| `chatbot.py` | Manages chatbot logic, potentially the main interface between users and the chatbot system. |
| `conversation_manager.py` | Handles conversations, possibly managing the state and flow of user dialogues. |
| `hate_speech_generator.py` | Script for generating hate speech examples, likely for testing or training models. |
| `llm_client.py` | Client interface for interacting with a large language model (LLM), handling communication with the model. |
| `llm_test.py` | Testing script for ensuring proper functionality of the LLM integration or chatbot. |
| `main.py` | Main entry point for the backend application. It initializes the bots, |
| `message_monitor.py` | Monitors and manages messages, possibly for filtering or logging purposes. |
| `utils.py` | Contains utility functions for the backend, typically used across various modules. |

---

### **Other files**

| **File**            | **Description**                                                                                                                                                                                    |
| ------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `.gitignore`        | Specifies which files and directories should be ignored by Git version control.                                                                                                                    |
| `descriptions.json` | JSON file containing a `general_system_prompt` for the bots in general, plus specific descriptions for each of them: `name`, `bot` (whether it's active), and specific `system_prompt` of the bot. |
| `hate_speech.txt`   | File containing examples of hate speech phrases, one per line.                                                                                                                                     |
| `README.md`         | Documentation (this file)                                                                                                                                                                          |
